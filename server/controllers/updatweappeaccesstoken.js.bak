const        request = require('request'),
util = require('util'), //引入 util 工具包
                  fs = require('fs'); //引入 fs 模块
             const https = require("https")
const config = require('../getaccesstoken');//引入配置文件

//设置 Weapp 对象属性 appID
var appID = config.appID;
//设置 Weapp 对象属性 appScrect
var appScrect = config.appScrect;
//设置 Weapp 对象属性 apiDomain
var apiDomain = config.apiDomain;
//设置 Weapp 对象属性 apiURL
var apiURL = config.apiURL;
console.log(apiURL)
var url = util.format(apiURL.accessTokenApi,apiDomain,appID,appScrect);
console.log(url)
https.get(url, (res) => {
  console.log(`Got response: ${res.statusCode}`);
  res.on('data', function(d) {
    process.stdout.write(d);
    fs.writeFile('../access_token.json', d);
  });
  // consume response body
  res.resume();
}).on('error', (e) => {
  console.log(`Got error: ${e.message}`);
});
module.exports = function (ctx, next) {
  ctx.state.data = { msg: '发送求助模板消息成功'}
};
